; Процедура возвращает в R0 код клавиши
; В R1 - значение 0, если нажатия нет
; 1 - если было событие нажатия
; 2 - если идет удержание клавиши
KEY_TESTER:
        TSTB    @#177660 ; Проверка клавиатуры, есть ли нажатие
        BPL     M1   ; Если нет, то проверим потом удержание.

        MOV	#1, R1  ; Код 1 - нажатие
        MOV	@#177662,R0 ; Чтение кода клавиши
        RTS PC
M1:     
        BIT #100,@#177716 ; Есть ли удержание клавиши (вторая проверка)
        BNE     M2   ; Если нет, то надо вернуть нули

        MOV	#2, R1  ; Код 2 - удержание
        MOV	@#177662,R0 ; Чтение кода клавиши
        RTS PC
M2:

        MOV	#0, R1
	MOV 	#0, R0
        RTS PC
